{% extends "layout.html" %}

{% block preload %}
<link rel="preload" href="{{ url_for('static', filename='js/decklist.js') }}" as="script">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/decklist.js') }}"></script>
{% endblock %}

{% block article %}
<article id="analysis">
{% block archetype_name %}{% endblock %}
<div id="review" class="review">
	{% block archetype %}{% endblock %}
</div>
<div id="decklist" class="decklist">
	<div id="list" class="list">
		<h2 id="deck-name"></h2>
		<p>
			<span id="deck-header"></span>
			â€”
			<span id="deck-footer"></span>
		</p>
		<div class="command_zone">
			<h3 id="command_zone">Command Zone</h3>
			<ul id="commanders">
			</ul>
		</div>
		<h3 id="library">Library</h3>
		<div class="library" id="library-container">
		</div>
	</div>
</div>
<iframe
	src="https://www.moxfield.com/embed/{% block moxfield %}{% endblock %}?hideTotal=true"
	id="moxfield-frame"
	frameBorder="0"
	onload="moxfieldOnLoad(event)"
></iframe>
</article>
{% endblock %}

{% block script %}
<script>
{%+ if self.moxfield() | trim %}
	var isMobile = window.matchMedia("only screen and (max-width: 760px)").matches;

	if (isMobile) {
		// Displaying custom decklist rendering
		window.onload = function () {
			const content = document.querySelector('meta[property="decklist"]').content
			const decklist = JSON.parse(JSON.parse(content))
			displayDeck(decklist)
			tippy('span.card', {
				touchHold: true,
				hideOnClick: false,
				interactive: true,
				placement: 'right',
				distance: 20,
				arrow: true,
				animateFill: false,
				animation: 'shift-away',
				// In ES5 as you don't have a transpilation step(?):
				onShow: function(instance) {
					var img = instance.popper.querySelector('img');
					img.src = img.dataset.src;
				}
			});
		}
		// Not displaying moxfield frame
		document.getElementById("moxfield-frame").style.display = "none";
	} else {
		// Displaying moxfield embed
		function moxfieldOnMessage(e){const t=e.data;if("object"==typeof t&&"moxfield"===t.type){const e=document.getElementById(t.id);;e&&(e.style.height=t.data+"px")}}function moxfieldOnLoad(e){e.target&&e.target.contentWindow&&e.target.contentWindow.postMessage({type:"moxfield",data:e.target.id},"*")}window.addEventListener("message",moxfieldOnMessage);
		// Not displaying custom decklist
		document.getElementById("decklist").style.display = "none";
	}
{% else %}
	// Displaying custom decklist rendering
	window.onload = function () {
		const content = document.querySelector('meta[property="decklist"]').content
		const decklist = JSON.parse(JSON.parse(content))
		displayDeck(decklist)
		tippy('span.card', {
			touchHold: true,
			hideOnClick: false,
			interactive: true,
			placement: 'right',
			distance: 20,
			arrow: true,
			animateFill: false,
			animation: 'shift-away',
			// In ES5 as you don't have a transpilation step(?):
			onShow: function(instance) {
				var img = instance.popper.querySelector('img');
				img.src = img.dataset.src;
			}
		});
	}
	// Not displaying moxfield frame
	document.getElementById("moxfield-frame").style.display = "none";
{% endif %}
</script>
{% endblock %}
